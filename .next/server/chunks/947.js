"use strict";exports.id=947,exports.ids=[947],exports.modules={6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},8159:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{O:()=>o});var i=r(9926),a=e([i]);let n=(i=(a.then?(await a)():a)[0]).z.object({KALSHI_API_ID:i.z.string().min(1),KALSHI_PRIVATE_KEY:i.z.string().min(1),VERCEL_AI_GATEWAY_KEY:i.z.string().min(1).optional(),AI_GATEWAY_API_KEY:i.z.string().min(1).optional(),VERCEL_OIDC_TOKEN:i.z.string().min(1).optional(),SUPABASE_URL:i.z.string().url(),SUPABASE_KEY:i.z.string().min(1).optional(),SUPABASE_SERVICE_ROLE_KEY:i.z.string().min(1).optional(),CRON_SECRET:i.z.string().min(1),DAILY_BUDGET:i.z.string().transform(Number).default("100"),MIN_ODDS:i.z.string().transform(Number).default("0.85"),MAX_ODDS:i.z.string().transform(Number).default("0.98"),MAX_DAYS_TO_RESOLUTION:i.z.string().transform(Number).default("2"),MIN_LIQUIDITY:i.z.string().transform(Number).default("2000"),DRY_RUN:i.z.string().transform(e=>"true"===e).default("false"),INITIAL_BANKROLL:i.z.string().transform(Number).default("1000")}),o=function(){try{let e=n.parse(process.env),t=e.SUPABASE_KEY||e.SUPABASE_SERVICE_ROLE_KEY;if(!t)throw Error("Missing SUPABASE_KEY (or SUPABASE_SERVICE_ROLE_KEY)");let r=e.VERCEL_AI_GATEWAY_KEY||e.AI_GATEWAY_API_KEY||e.VERCEL_OIDC_TOKEN;if(!r)throw Error("Missing VERCEL_AI_GATEWAY_KEY (or AI_GATEWAY_API_KEY / VERCEL_OIDC_TOKEN)");return{...e,SUPABASE_KEY:t,VERCEL_AI_GATEWAY_KEY:r}}catch(e){if(e instanceof i.z.ZodError){let t=e.errors.map(e=>e.path.join(".")).join(", ");throw Error(`Missing or invalid environment variables: ${t}`)}throw e}}();s()}catch(e){s(e)}})},913:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{Et:()=>g,K3:()=>f,TN:()=>u,U:()=>l,YI:()=>E,YK:()=>h,Z9:()=>_,fetchMarkets:()=>m,mR:()=>d,s1:()=>A,up:()=>p});var i=r(8159),a=r(4770),n=r.n(a),o=e([i]);i=(o.then?(await o)():o)[0];let f="https://api.elections.kalshi.com/trade-api/v2";function l(e,t,r){let s=Date.now().toString();13!==s.length&&console.error("âš ï¸ WARNING: Timestamp is not 13 digits:",s);let a=function(e,t,r,s){let a;let o=r.split("?")[0],l=`${e}${t.toUpperCase()}${o}${s||""}`;"true"===process.env.DEBUG_AUTH&&console.log("\uD83D\uDD10 Signature Debug:",{timestamp:e,timestampLength:e.length,method:t.toUpperCase(),pathWithParams:r,pathWithoutParams:o,bodyLength:s?s.length:0,messageLength:l.length,messagePreview:l.substring(0,150),messageFull:l});let u=(((a=(i.O.KALSHI_PRIVATE_KEY??"").trim()).startsWith('"')&&a.endsWith('"')||a.startsWith("'")&&a.endsWith("'"))&&(a=a.slice(1,-1).trim()),a=(a=a.replace(/\\n/g,"\n")).replace(/\r\n/g,"\n"));if(!u.includes("BEGIN RSA PRIVATE KEY")&&!u.includes("BEGIN PRIVATE KEY")&&!u.includes("BEGIN ENCRYPTED PRIVATE KEY"))throw Error("Invalid private key format: missing PEM BEGIN marker");try{let e;let t=n().createPrivateKey(u);n().constants;try{e=n().sign("sha256",Buffer.from(l),{key:t,padding:n().constants.RSA_PKCS1_PSS_PADDING,saltLength:n().constants.RSA_PSS_SALTLEN_DIGEST})}catch(r){console.warn("RSA-PSS with DIGEST salt length failed, trying MAX_SIGN:",r.message),e=n().sign("sha256",Buffer.from(l),{key:t,padding:n().constants.RSA_PKCS1_PSS_PADDING,saltLength:n().constants.RSA_PSS_SALTLEN_MAX_SIGN})}let r=e.toString("base64");return"true"===process.env.DEBUG_AUTH&&console.log("\uD83D\uDD10 Signature created:",{signatureLength:r.length,signaturePreview:r.substring(0,20)+"..."}),r}catch(e){throw console.error("âŒ Signature creation error:",{error:e.message,stack:e.stack,keyFormat:u.substring(0,50)+"..."}),Error(`Failed to create signature: ${e?.message||String(e)}. Check KALSHI_PRIVATE_KEY format.`)}}(s,e,t,r),o={"KALSHI-ACCESS-KEY":i.O.KALSHI_API_ID,"KALSHI-ACCESS-TIMESTAMP":s,"KALSHI-ACCESS-SIGNATURE":a,"Content-Type":"application/json"};return"true"===process.env.DEBUG_AUTH&&console.log("\uD83D\uDD10 Auth Headers:",{apiKey:i.O.KALSHI_API_ID.substring(0,10)+"...",timestamp:s,timestampLength:s.length,signatureLength:a.length,pathWithParams:t,method:e}),o}function u(e){return"number"==typeof e.yes_bid?Math.round(e.yes_bid):"number"==typeof e.yes_bid_dollars?Math.round(100*e.yes_bid_dollars):"number"==typeof e.yesBid?Math.round(e.yesBid):"number"==typeof e.yesBidDollars?Math.round(100*e.yesBidDollars):"number"==typeof e.yes_odds&&e.yes_odds>0&&e.yes_odds<=1?Math.round(100*e.yes_odds):null}function c(e){return new Promise(t=>setTimeout(t,e))}async function d(e){let t=[],r=null,s=0,i=e?.rateLimitMs??500,a=e?.maxPages??100;console.log(`ðŸ” Fetching all active markets from Kalshi (with pagination, ${i}ms rate limit)...`);do{if(++s>a){console.warn(`âš ï¸ Reached max pages limit (${a}). Stopping pagination.`);break}let e="/markets?status=open";r&&(e+=`&cursor=${r}`);try{let a=await fetch(`${f}${e}`,{method:"GET",headers:l("GET",e)});if(!a.ok){if(429===a.status){let e=a.headers.get("Retry-After"),t=e?1e3*parseInt(e):5e3;console.warn(`âš ï¸ Rate limited (429). Waiting ${t}ms before retry...`),await c(t);continue}let e=await a.text();throw Error(`Kalshi API error: ${a.status} ${a.statusText} - ${e}`)}let n=await a.json(),o=n.markets||[];if(t.push(...o),r=n.cursor||null,console.log(`   Page ${s}: Fetched ${o.length} markets (total: ${t.length})`),!r||0===o.length)break;r&&o.length>0&&await c(i)}catch(e){if(e.message.includes("429")||e.message.includes("rate")){console.warn(`âš ï¸ Rate limit error. Waiting ${2*i}ms before retry...`),await c(2*i);continue}throw console.error(`Error fetching markets page ${s}:`,e.message),e}}while(r);return console.log(`âœ… Fetched ${t.length} total markets across ${s} pages`),t.map(e=>{let t;let r=u(e);try{t=new Date(e.expiration_time||e.expirationTime||e.end_date),isNaN(t.getTime())&&(console.warn(`Invalid expiration date for market ${e.ticker}: ${e.expiration_time}`),t=new Date(Date.now()+6048e5))}catch(e){t=new Date(Date.now()+6048e5)}return{market_id:e.ticker||e.market_id||e.id,question:e.title||e.question||e.subtitle||"N/A",end_date:t,yes_odds:null!==r?r/100:0,no_odds:null!==r?(100-r)/100:0,liquidity:0,volume_24h:parseFloat(e.volume||e.volume_24h||0),resolved:"closed"===e.status||"resolved"===e.status,category:e.category||void 0,outcome:e.result?"yes"===e.result?"YES":"NO":void 0,final_odds:e.result_price?parseFloat(e.result_price)/100:void 0,resolved_at:e.settlement_time?new Date(e.settlement_time):void 0}})}async function _(e){let t,r;let s=`/markets/${e}/orderbook`,i=await fetch(`${f}${s}`,{method:"GET",headers:l("GET",s)});if(!i.ok){let e=await i.text();throw Error(`Failed to fetch orderbook: ${i.status} ${i.statusText} - ${e}`)}let a=await i.json(),n=a.orderbook||a,o=n.yes_bids||n.yesBids||[],u=n.yes_asks||n.yesAsks||[],c=n.no_bids||n.noBids||[],d=n.no_asks||n.noAsks||[],_=o.length>0?{price:parseFloat(o[0].price||o[0].price_cents||o[0])/100,size:parseInt(o[0].size||o[0].quantity||"0",10)}:{price:0,size:0},E=u.length>0?{price:parseFloat(u[0].price||u[0].price_cents||u[0])/100,size:parseInt(u[0].size||u[0].quantity||"0",10)}:{price:0,size:0},m=c.length>0?{price:parseFloat(c[0].price||c[0].price_cents||c[0])/100,size:parseInt(c[0].size||c[0].quantity||"0",10)}:{price:0,size:0},h=d.length>0?{price:parseFloat(d[0].price||d[0].price_cents||d[0])/100,size:parseInt(d[0].size||d[0].quantity||"0",10)}:{price:0,size:0},p=100*_.price;return p>=85?(t=_.size,r="YES"):p<=15?(t=m.size,r="NO"):(t=_.size,r="YES"),{orderbook:{market_id:e,bestYesBid:_.price,bestYesAsk:E.price,bestNoBid:m.price,bestNoAsk:h.price},liquidity:t,side:r}}function E(e){let t=new Date,r=e.getTime()-t.getTime();return Math.max(0,r/864e5)}async function m(){return d()}async function h(e){let t=`/markets/${e}`,r=await fetch(`${f}${t}`,{method:"GET",headers:l("GET",t)});if(!r.ok){let e=await r.text();throw Error(`Failed to fetch market: ${r.status} ${r.statusText} - ${e}`)}let s=await r.json(),i=s.market||s,a=u(i);return{market_id:i.ticker||i.market_id||i.id,question:i.title||i.question||i.subtitle,end_date:new Date(i.expiration_time||i.expirationTime||i.end_date),yes_odds:null!==a?a/100:0,no_odds:null!==a?(100-a)/100:0,liquidity:parseFloat(i.liquidity||i.open_interest||0),volume_24h:parseFloat(i.volume||i.volume_24h||0),resolved:"closed"===i.status||"resolved"===i.status,category:i.category||void 0,outcome:i.result?"yes"===i.result?"YES":"NO":void 0,final_odds:i.result_price?parseFloat(i.result_price)/100:void 0,resolved_at:i.settlement_time?new Date(i.settlement_time):void 0}}async function p(e){let{orderbook:t}=await _(e);return t}async function g(){let e="/portfolio/balance",t=await fetch(`${f}${e}`,{method:"GET",headers:l("GET",e)});if(!t.ok){let e=await t.text();throw Error(`Failed to fetch balance: ${t.status} ${t.statusText} - ${e}`)}let r=await t.json();return(r.balance||r.available_balance||r.total_balance||0)/100}async function A(e){if("true"===process.env.DRY_RUN)return console.log("\uD83E\uDDEA DRY RUN: Would place order:",e),{order_id:"dry-run-order",status:"resting"};let t="/portfolio/orders",r="YES"===e.side||"SELL_YES"===e.side?"yes":"no",s=e.side.startsWith("SELL")?"sell":"buy",i=Math.max(1,Math.min(99,Math.floor(100*e.price))),a=JSON.stringify({ticker:e.market,side:r,action:s,count:Math.floor(e.amount),price:i,type:"limit"}),n=await fetch(`${f}${t}`,{method:"POST",headers:l("POST",t,a),body:a});if(!n.ok){let e=await n.text();throw Error(`Failed to place order: ${n.status} ${n.statusText} - ${e}`)}let o=await n.json();return o.order||o}s()}catch(e){s(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};