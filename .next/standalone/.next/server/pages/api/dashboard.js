"use strict";(()=>{var t={};t.id=222,t.ids=[222],t.modules={145:t=>{t.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4770:t=>{t.exports=require("crypto")},1309:t=>{t.exports=import("@supabase/supabase-js")},9926:t=>{t.exports=import("zod")},8110:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{config:()=>l,default:()=>d,routeModule:()=>u});var n=r(1802),s=r(7153),o=r(6249),c=r(4409),i=t([c]);c=(i.then?(await i)():i)[0];let d=(0,o.l)(c,"default"),l=(0,o.l)(c,"config"),u=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/dashboard",pathname:"/api/dashboard",bundlePath:"",filename:""},userland:c});a()}catch(t){a(t)}})},8231:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{O:()=>c});var n=r(1309),s=r(8159),o=t([n,s]);[n,s]=o.then?(await o)():o;let c=(0,n.createClient)(s.O.SUPABASE_URL,s.O.SUPABASE_KEY);a()}catch(t){a(t)}})},3435:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{$r:()=>i,FC:()=>w,Jg:()=>u,Of:()=>m,Pq:()=>d,Xb:()=>l,Xx:()=>_,dY:()=>p,fT:()=>g,lv:()=>c,mo:()=>o,sl:()=>f,zC:()=>y});var n=r(8231),s=t([n]);async function o(){let{data:t,error:e}=await n.O.from("trades").select(`
      *,
      contract:contracts(*)
    `).eq("status","open").order("executed_at",{ascending:!1});if(e)throw e;return t}async function c(t=50){let{data:e,error:r}=await n.O.from("trades").select(`
      *,
      contract:contracts(*)
    `).order("executed_at",{ascending:!1}).limit(t);if(r)throw r;return e}async function i(){let t=new Date;t.setHours(0,0,0,0);let{data:e,error:r}=await n.O.from("trades").select(`
      *,
      contract:contracts(*)
    `).gte("executed_at",t.toISOString()).order("executed_at",{ascending:!1});if(r)throw r;return e}async function d(t,e){let{data:r,error:a}=await n.O.from("trades").select(`
      *,
      contract:contracts(*)
    `).gte("executed_at",t.toISOString()).lte("executed_at",e.toISOString()).order("executed_at",{ascending:!1});if(a)throw a;return r}async function l(t){let{data:e,error:r}=await n.O.from("trades").insert({...t,status:"open",executed_at:new Date().toISOString()}).select(`
      *,
      contract:contracts(*)
    `).single();if(r)throw r;return e}async function u(t,e){let{data:r,error:a}=await n.O.from("trades").update(e).eq("id",t).select(`
      *,
      contract:contracts(*)
    `).single();if(a)throw a;return r}async function f(){return(await o()).map(t=>({trade:t,current_odds:t.entry_odds,unrealized_pnl:0,unrealized_pnl_pct:0}))}async function p(){let{data:t}=await n.O.from("performance_metrics").select("bankroll").order("date",{ascending:!1}).limit(1).single();return t?.bankroll||Number(process.env.INITIAL_BANKROLL)||1e3}async function w(){return Number(process.env.INITIAL_BANKROLL)||1e3}async function _(t){let{data:e}=await n.O.from("performance_metrics").select("bankroll").lte("date",t.toISOString()).order("date",{ascending:!1}).limit(1).single();return e?.bankroll||Number(process.env.INITIAL_BANKROLL)||1e3}async function m(){let t=await p(),e=(await f()).reduce((t,e)=>t+e.trade.position_size,0);return t-e}async function g(){let{data:t,error:e}=await n.O.from("notification_preferences").select("*").eq("user_id","default").single();if(e&&"PGRST116"!==e.code)throw e;return t||{enabled:!1}}async function y(t){let e=new Date(Date.now()-36e5*t),{data:r,error:a}=await n.O.from("stop_loss_events").select(`
      *,
      trade:trades(
        *,
        contract:contracts(*)
      )
    `).gte("executed_at",e.toISOString()).order("executed_at",{ascending:!1});if(a)throw a;return r}n=(s.then?(await s)():s)[0],a()}catch(t){a(t)}})},1258:(t,e,r)=>{function a(t){let e=t.filter(t=>"open"!==t.status);return 0===e.length?0:e.filter(t=>"won"===t.status).length/e.length}function n(t){return t.reduce((t,e)=>t+(e.pnl||0),0)}r.d(e,{tt:()=>a,yj:()=>n})},4409:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.r(e),r.d(e,{default:()=>i});var n=r(3435),s=r(913),o=r(1258),c=t([n,s]);async function i(t,e){if("GET"!==t.method)return e.status(405).json({error:"Method not allowed"});try{let t=await (0,n.lv)(1e3),r=t.filter(t=>"open"!==t.status),a=await (0,n.dY)(),c=await (0,n.FC)(),i=(0,o.yj)(r),d=(0,o.tt)(r),l=await (0,n.mo)(),u=await (0,n.sl)(),f=await Promise.all(u.map(async t=>{try{let e=await (0,s.YK)(t.trade.contract.market_id),r="YES"===t.trade.side?e.yes_odds:e.no_odds,a=t.trade.contracts_purchased*r-t.trade.position_size,n=a/t.trade.position_size*100;return{...t,current_odds:r,unrealized_pnl:a,unrealized_pnl_pct:n}}catch(e){return{...t,current_odds:t.trade.entry_odds,unrealized_pnl:0,unrealized_pnl_pct:0}}})),p=new Date,w=new Date(p.getFullYear(),p.getMonth(),1),_=(await (0,n.Pq)(w,p)).filter(t=>"open"!==t.status),m=(0,o.yj)(_),g=await (0,n.FC)(),y=new Date(p.getFullYear(),0,1),h=(await (0,n.Pq)(y,p)).filter(t=>"open"!==t.status),O=(0,o.yj)(h),x=t.slice(0,20);return e.status(200).json({currentBankroll:a,initialBankroll:c,totalPnL:i,totalReturn:c>0?i/c*100:0,winRate:d,totalTrades:t.length,openTrades:l.length,mtdPnL:m,mtdReturn:g>0?m/g*100:0,ytdPnL:O,ytdReturn:c>0?O/c*100:0,recentTrades:x,openPositions:f})}catch(t){return console.error("Dashboard API error:",t),e.status(500).json({error:t.message})}}[n,s]=c.then?(await c)():c,a()}catch(t){a(t)}})}};var e=require("../../webpack-api-runtime.js");e.C(t);var r=t=>e(e.s=t),a=e.X(0,[947],()=>r(8110));module.exports=a})();